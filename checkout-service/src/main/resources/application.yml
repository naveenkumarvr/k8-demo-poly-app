# Poly-Shop Checkout Service - Spring Boot Configuration
# Configured for Kubernetes readiness with health probes and distributed tracing

server:
  port: 8085
  shutdown: graceful # Graceful shutdown for K8s termination

spring:
  application:
    name: checkout-service
  
  # H2 In-Memory Database Configuration
  datasource:
    url: jdbc:h2:mem:checkoutdb
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  
  # JPA/Hibernate Configuration
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop # Auto-create schema on startup
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  
  # H2 Console (for debugging, disable in production)
  h2:
    console:
      enabled: true
      path: /h2-console

# Spring Boot Actuator - Kubernetes Health Probes
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true # Enable liveness & readiness probes
  
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true

# Logging Configuration
# Logs will show OTel trace IDs for correlation
logging:
  level:
    root: INFO
    com.polyshop.checkout: DEBUG
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# Application Configuration
checkout:
  # Cart Service URL (Docker Compose / K8s service name)
  cart-service-url: ${CART_SERVICE_URL:http://cart-service:8080}
  
  # Payment Processing Simulation
  payment:
    success-rate: 0.8 # 80% success rate
    processing-time-ms: 200 # Simulated processing delay
  
  # Startup Delay for Testing K8s startupProbe
  startup-delay-seconds: ${STARTUP_DELAY_SECONDS:15}

# Currency Conversion Rates (Mock Data)
currency:
  rates:
    USD_TO_CAD: 1.35
    USD_TO_EUR: 0.92
    USD_TO_GBP: 0.79
    CAD_TO_USD: 0.74
    EUR_TO_USD: 1.09
    GBP_TO_USD: 1.27
